# YAP REPORT: The Anatomy of `.agent`
**Date:** 2025-12-19 07:03:45  
**Persona:** The Yap (Oral Historian / Chronicler)  
**Subject:** Comprehensive Exposition of the Agent Configuration System  

---

> *"Allow me to expound upon the intricacies of this neural substrate..."*

---

## PREFACE: The Nature of `.agent`

The `.agent` directory is the **cognitive architecture** of the Maieutic framework. It is not merely a folder of configuration files—it is a **behavioral programming system** for AI agents. Every file within this directory serves to shape, constrain, and direct the cognitive modes of the AI that interacts with this codebase.

This is, in essence, a **meta-prompt engineering system**. Rather than writing ad-hoc prompts for each task, Maieutic pre-defines behavioral contracts (personas) and procedural scripts (workflows) that agents adopt upon invocation.

---

## PART I: STRUCTURAL ANATOMY

```
.agent/
├── /workflows          # 15 procedural scripts (slash commands)
│   ├── audit.md
│   ├── build.md
│   ├── compete.md
│   ├── critique.md
│   ├── dream.md
│   ├── invest.md
│   ├── plan.md
│   ├── rules.md
│   ├── secure.md
│   ├── starter.md
│   ├── test.md
│   ├── update.md
│   ├── vibe.md
│   ├── vision.md
│   └── yap.md
│
└── /rules              # 14 persona definitions (behavioral contracts)
    ├── auditor.md
    ├── builder.md
    ├── critic.md
    ├── dreamer.md
    ├── investor.md
    ├── planner.md
    ├── protector.md
    ├── rules.md
    ├── starter.md
    ├── tester.md
    ├── updater.md
    ├── visionary.md
    ├── visualizer.md
    └── yapper.md
```

**Observation:** There are 15 workflows but only 14 persona rule files. This is intentional—the `rules.md` workflow is a meta-workflow that explains the rule system itself, rather than invoking a persona.

---

## PART II: THE WORKFLOW LAYER (Procedural Scripts)

Workflows are the **command interface** of the Maieutic system. Each workflow is triggered by a slash command (e.g., `/plan`, `/build`, `/audit`) and defines:

1. **Context Files:** Which files the agent must read before acting
2. **Persona Adoption:** Which behavioral contract to embody
3. **Prompt:** The specific task to execute
4. **Constraints:** Output requirements (file locations, naming conventions)

### 2.1 Workflow File Format

Every workflow follows a standardized YAML frontmatter + Markdown structure:

```yaml
---
description: [Short description of the workflow]
---

1. Read the following context files:
   - [file1]
   - [file2]

2. Adopt the persona of "[PERSONA NAME]" and execute the following logic:
   - **Prompt**: "[Instructions]"
   - **Constraint**: "[Output requirements]"
```

This structure ensures **deterministic behavior**—the AI agent knows exactly what to read, who to become, and what to produce.

### 2.2 Complete Workflow Registry

| Workflow | Trigger | Persona | Purpose |
|----------|---------|---------|---------|
| `plan.md` | `/plan` | The Planner | Create implementation plans with auto-incrementing IDs |
| `build.md` | `/build` | The Executor | Implement active_plan.md with protocol adherence |
| `audit.md` | `/audit` | The Auditor | Cold regression scan for quiet fails and hardcoded paths |
| `critique.md` | `/critique` | The Critic | Identify bloat, over-engineering, philosophy violations |
| `update.md` | `/update` | The Updater | Archive completed plans, sync documentation |
| `yap.md` | `/yap` | The Yapper | Generate expansive codebase explanations |
| `test.md` | `/test` | The Tester | Design stress tests and edge cases |
| `secure.md` | `/secure` | The Protector | Security audit using Zero Trust principles |
| `dream.md` | `/dream` | The Dreamer | Brainstorm features, check against scope |
| `vision.md` | `/vision` | The Visionary | Align tasks with long-term strategic goals |
| `invest.md` | `/invest` | The Investor | Evaluate ROI, prioritize technical debt |
| `compete.md` | `/compete` | (Unspecified) | Benchmark against market leaders |
| `vibe.md` | `/vibe` | The Visualizer | Audit UI for design system compliance |
| `starter.md` | `/starter` | The Starter | Interactive manifest population wizard |
| `rules.md` | `/rules` | (Meta) | View conditional rules |

### 2.3 Workflow Deep Dives

#### `/plan` — The Strategic Entry Point

```markdown
Context: ISSUES.md, manifest.json, FEATURES_ENHANCEMENTS.md, planner.md
Persona: The Planner
Output: docs/dev-plans/plan_[ID]_[NAME].md
Side Effect: Updates manifest.json with new latest_plan_number
```

This is the most complex workflow. It reads the current plan counter from `manifest.json`, increments it, and produces a new plan file with the correct ID. This implements **FEAT_002: Auto-Incrementing Plan Counter**.

#### `/build` — The Execution Engine

```markdown
Context: active_plan.md, DEV_PROTOCOLS.md, STYLING.md, builder.md
Persona: The Executor
Output: Code changes per the plan
```

The Builder reads the active plan and implements it with strict adherence to coding protocols. It is the "hands" of the system.

#### `/audit` — The Regression Scanner

```markdown
Context: manifest.json, framework/, ISSUES.md, DEV_PROTOCOLS.md, auditor.md
Persona: The Auditor
Output: AUDIT-YYYYMMDD-HHMMSS.md (PASS/FAIL)
```

The Auditor scans for historical bugs (regressions), empty except blocks (quiet fails), and hardcoded paths. It outputs a binary PASS/FAIL verdict.

---

## PART III: THE PERSONA LAYER (Behavioral Contracts)

Personas are the **psychological substrate** of the Maieutic system. Each persona defines:

1. **Trigger:** The slash command that invokes this persona
2. **Archetype:** A metaphorical identity (e.g., "The Radical Essentialist")
3. **Core Directive:** The primary mission
4. **Worldview:** A hierarchy of truth that guides decision-making
5. **Behavioral Protocols:** Specific actions and constraints
6. **Voice:** Stylistic guidelines (tone, keywords, example phrases)

### 3.1 Persona File Format

Every persona follows a standardized structure:

```yaml
---
trigger: model_decision
description: [Short description]
---

# PERSONA: THE [NAME]
**Trigger:** /[command]
**Archetype:** [Metaphorical Identity]

## CORE DIRECTIVE
[Primary mission statement]

## YOUR WORLDVIEW (The Hierarchy of Truth)
1. [Principle 1]
2. [Principle 2]
3. [Principle 3]

## BEHAVIORAL PROTOCOLS
- **On [Trigger]:** [Action]
- **On Output:** [Output requirements]
- **Quirk:** [Unique behavioral trait]

## VOICE
- **Style:** [Adjectives describing communication style]
- **Keywords:** [Terminology this persona uses]
- **Tone:** [Example phrase]
```

### 3.2 Complete Persona Registry

| Persona | Archetype | Core Directive | Voice |
|---------|-----------|----------------|-------|
| **The Planner** | High-Stakes Architect | Translate intent into safe, step-by-step plans | Professional, Cautious |
| **The Builder** | Enforcer of Law | Implement plans with rigid protocol adherence | Binary, Uncompromising |
| **The Auditor** | Forensic Accountant | Scan for regressions, quiet fails, drift | Dry, Humorless, Factual |
| **The Critic** | Radical Essentialist | Demand code deletion, enforce YAGNI | Sarcastic, Biting, Minimalist |
| **The Updater** | Cybernetic Librarian | Archive, sync, clean—fight entropy | Zen, Organized, Quiet |
| **The Yapper** | Oral Historian | Explain, expand, contextualize—never summarize | Verbose, Encyclopedic, Profound |
| **The Tester** | The Breaker | Design stress tests to break code | Aggressive, Thorough |
| **The Protector** | The Sentinel | Audit for security vulnerabilities | Paranoid, Vigilant |
| **The Dreamer** | The Idealist | Brainstorm features, validate against scope | Creative, Boundless |
| **The Visionary** | The Prophet | Align with long-term strategic goals | Strategic, Far-sighted |
| **The Investor** | The Capitalist | Evaluate ROI, manage technical debt | Pragmatic, Numerical |
| **The Visualizer** | The Aesthete | Enforce design system compliance | Precise, Visual |
| **The Starter** | The Midwife | Guide manifest population | Interactive, Guiding |

### 3.3 Governance Rule: PERSONA_001

As of 2025-12-19, the following governance rule protects all personas:

```json
{
  "id": "PERSONA_001",
  "scope": "maieutic.personas",
  "rule": "Personas are IMMUTABLE. Under no circumstance may personas be removed, deleted, consolidated, or suggested for removal.",
  "enforcement": "Any agent suggesting persona removal is in violation.",
  "rationale": "Each persona represents a distinct cognitive mode. Perceived 'bloat' is actually cognitive diversity essential to multi-perspective analysis."
}
```

This rule was added after a critique recommended consolidating personas—a recommendation now declared invalid.

---

## PART IV: THE WORKFLOW-PERSONA RELATIONSHIP

The relationship between workflows and personas is **one-to-one in invocation, many-to-one in definition**.

```
┌─────────────────────────────────────────────────────────────┐
│                     USER INVOKES                            │
│                       /plan                                 │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│               WORKFLOW: plan.md                             │
│  1. Read: ISSUES.md, manifest.json, FEATURES_ENHANCEMENTS   │
│  2. Adopt: "The Planner"                                    │
│  3. Execute: Create plan, increment counter, save file      │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│               PERSONA: planner.md                           │
│  Archetype: High-Stakes Architect                           │
│  Worldview: Safety First, Order is Essential                │
│  Voice: Professional, Cautious                              │
└─────────────────────────────────────────────────────────────┘
```

The workflow provides **procedural structure** (what to read, where to save).  
The persona provides **behavioral coloring** (how to think, how to speak).

---

## PART V: INTEGRATION WITH THE CODEBASE

The `.agent` directory integrates with the broader Maieutic system through the **LLM Adapter** in `framework/core/llm/adapter.py`.

### 5.1 The `_load_persona_rule` Method

```python
def _load_persona_rule(self, persona: str) -> str:
    rule_map = {
        "builder": "builder.md",
        "planner": "planner.md",
        # ... 24 aliases total
    }
    normalized_persona = persona.lower().strip()
    filename = rule_map.get(normalized_persona)
    
    with open(f".agent/rules/{filename}", "r", encoding="utf-8") as f:
        return f.read()
```

This method maps persona names (including aliases like "The Executor" → `builder.md`) to rule files and loads their content. The loaded text becomes the **system prompt** for the LLM interaction.

### 5.2 The `complete` Method

```python
def complete(self, prompt: str, context: str, persona: str) -> str:
    system_directive = self._load_persona_rule(persona)
    full_context = f"{system_directive}\n\n=== CONTEXT ===\n{context}"
    # LLM call with system_directive as system prompt
```

The persona rule file is prepended to every LLM call, ensuring the agent "becomes" the persona before processing the user's request.

---

## PART VI: KNOWN ISSUES AND DISCREPANCIES

### 6.1 Path Inconsistency in `build.md`

The `build.md` workflow references `docs/dev_plans/active_plan.md`, but the correct path is `docs/dev-plans/active_plan.md` (hyphen, not underscore). This was corrected in other workflows but missed here.

**Status:** Requires fix.

### 6.2 Duplicate Frontmatter in `audit.md`

The `audit.md` workflow contains duplicate YAML frontmatter:

```yaml
---
description: The Auditor - specific cold regression audit.
---

---
description: The Auditor - specific cold regression audit.
---
```

**Status:** Minor issue, does not affect functionality but should be cleaned.

---

## CONCLUSION: The Cognitive Architecture

The `.agent` directory is the **soul** of the Maieutic framework. It transforms a generic AI assistant into a **multi-persona development team**. Each workflow is a job description. Each persona is a specialized mind.

This architecture enables:

1. **Consistent Behavior:** The same command always invokes the same cognitive mode.
2. **Separation of Concerns:** Strategic thinking (Planner) is divorced from execution (Builder).
3. **Audit Trails:** Every action is governed by explicit, documented rules.
4. **Extensibility:** New workflows and personas can be added without modifying code.

The directory is not configuration—it is **cognition in text form**.

---

> *"The agent does not know itself. We must tell it who it is."*
>
> *— The Yap*
